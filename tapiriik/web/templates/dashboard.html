{% extends "site.html" %}
{% load i18n %}
{% load services %}
{% load users %}
{% load displayutils %}
{% block title %}{% if user != none %}{% trans "dashboard" %}{% else %}{% trans "sync your runs, rides & more" %}{% endif %}{% endblock %}

{% block content %}
{% if user != none %}
	<h3>Synchronisez vos applications de suivi sportif avec Decathlon</h3>
	<p v-if="!isOneSvcConnected">Pour commencer à synchroniser vos activités choisissez le service ou les
		services que vous souhaitez
		synchroniser.</p>

	<div class="legend-grid">
		<div class="legend-item">
			<div class="round-icon vtmn-text-white green">
				<span class="vtmx-arrow-left-right-line"></span>
			</div>
			<small>
				Synchronisation bi-directionnelle<br>
				(récupération <b>ET</b> envoi d’activités)
			</small>
		</div>
		<div class="legend-item">
			<div class="round-icon blue">
				<span class="vtmx-left-emphasized-arrow-left-right">
				</span>
			</div>
			<small>
				Synchronisation uni-directionnelle<br>
				(récupération <b>OU</b> envoi d’activités)
			</small>
		</div>
	</div>

	<ul class="vtmn-mb-2 services-list">
		<li v-for="service in services" :key="service.id" :id="service.id">
			<div>
				<img class="vtmn-h-4" :src="'{{STATIC_URL}}img/decathlon/logos/'+service.id+'.png'" :alt="service.displayName+' logo'">
				<div class="vtmn-flex vtmn-h-5 vtmn-mt-2">
					<div
						:class="['round-icon', !service.isConnected ? 'grey' : service.isBidirectional ? 'green' : 'blue']">
						<span
							:class="service.isBidirectional ? 'vtmn-text-white vtmx-arrow-left-right-line' : 'vtmx-left-emphasized-arrow-left-right'"></span>
					</div>
					<small class="grey-text my-2px" v-if="service.isConnected">Synchronisé</small>
					<small class="grey-text my-2px" v-if="!service.isConnected">Non synchronisé</small>
				</div>
			</div>
			<button v-if="service.isConnected" class="button-sync vtmn-mt-1"
				@click="openDisconnectModal(service.id)">Désynchroniser</button>
			<a v-if="!service.isConnected" class="button button-sync vtmn-mt-1" :href="service.authURI">Synchroniser</a>
		</li>
	</ul>

	<div id="sync-management" v-if="isOneSvcConnected">
		<h4>Activités</h4>
		<button id="sync-now-btn" class="vtmn-mb-4 vtmn-btn--icon-right" :disabled="syncNowBtnDisabled" @click="syncNow">
			Lancer une synchronisation
			<span class="vtmx-refresh-line vtmn-h-4 vtmn-pr-2"></span>
		</button>

		<ul class="recent-sync vtmn-mb-2">
			<li>
				<div class="vtmn-col-span-3">
					<small class="small vtmn-pb-4"><b>Date</b></small>
					<small class="small">18/07/2021</small>
				</div>
				<div class="vtmn-col-span-5">
					<small class="vtmn-pb-4"><b>Details</b></small>
					<small><b>Durée : </b>46 min.</small>
					<small><b>Lieu : </b>V2</small>
					<small><b>Activité : </b>Cyclo</small>
					<small><b>Source : </b>DKT</small>
					<small><b>Destination : </b>Strava</small>
				</div>
			</li>
			<li>
				<div class="vtmn-col-span-3">
					<small class="small vtmn-pb-4"><b>Date</b></small>
					<small class="small">18/07/2021</small>
				</div>
				<div class="vtmn-col-span-5">
					<small class="vtmn-pb-4"><b>Details</b></small>
					<small><b>Durée : </b>46 min.</small>
					<small><b>Lieu : </b>V2</small>
					<small><b>Activité : </b>Cyclo</small>
					<small><b>Source : </b>DKT</small>
					<small><b>Destination : </b>Strava</small>
				</div>
			</li>
		</ul>
		<div class="vtmn-flex vtmn-justify-center">
			<a href="" class="button secondary">Voir tout</a>
		</div>
	</div>

	<ul class="informations" v-if="!isOneSvcConnected">
		<li>
			<h4>Sécurité</h4>
			<p>Vos email, mots de passe et activités sportives sont en lieu sûr, plus de détails sur la page
				données personnelles.</p>
		</li>
		<li>
			<h4>Comment ça marche ?</h4>
			<p>Il suffit de vous connecter avec Decathlon et ensuite vous connecter à tous les services que vous
				souhaitez synchroniser, puis cliquez sur "Lancer Synchro"</p>
			<a class="button secondary" href="./faq.html">Lire la FAQ</a>
		</li>
	</ul>

	<div class="modal" role="dialog" aria-modal="true" v-show="disconnectModalValues.isOpen" v-cloak
		@click="closeDisconnectModal">
		<div class="modal-body" @click.stop>
			<div class="modal-body-title">
				<h4>Désynchroniser</h4>
				<div class="round-icon vtmn-text-black" @click="closeDisconnectModal">
					<span class="vtmx-close-line"></span>
				</div>
			</div>
			<img :src="'{{STATIC_URL}}img/decathlon/logos/'+disconnectModalValues.svcId+'.png'"
				:alt="disconnectModalValues.svdDisplayName+' logo'">
			<p>
				En désynchronisant, {{disconnectModalValues.svdDisplayName}} ne transmettra plus vos activités
				dans vos applications Decathlon. Aucune donnée ne sera supprimée.
			</p>
			<div class="modal-body-buttons">
				<button @click="confirmDisconnection(disconnectModalValues.svcId)">Oui, désynchroniser
					{{disconnectModalValues.svdDisplayName}}</button>
				<button class="secondary" @click="closeDisconnectModal">Non, annuler</button>
			</div>
		</div>
	</div>

	<div class="modal" v-show="isLoading" v-cloak>
		<div class="vtmn-m-auto">
			<h3 class="vtmn-text-white vtmn-w-2/3 vtmn-m-auto vtmn-text-center">Désynchronisation en cours, veuillez patienter</h3>
			<div class="loader" v-show="!loadingSuccess"></div>

			<svg class="checkmark" v-show="loadingSuccess" xmlns="http://www.w3.org/2000/svg"
				viewBox="0 0 52 52">
				<circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none" />
				<path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" />
			</svg>
		</div>
	</div>


	
		
	{% if user.Substitute %}
		<h1>{% trans "Substituting user" %}</h1>
		<a href="{% url 'diagnostics_unsu' %}">{% trans "Return" %}</a>
		<hr/>
	{% endif %}

{% else %}
	{% ifequal device_support 'web' %}
	<h3>Synchronisez vos applications de suivi sportif avec Decathlon</h3>
	<p>Retrouvez vos activités dans vos applications préférées et cumulez des points pour gagner des récompenses grâce au DECAT’CLUB</p>

	<ul class="steps-list mobile:vtmn-grid vtmn-flex">
		<li class="vtmn-flex mobile:vtmn-space-x-2 vtmn-items-center vtmn-flex-col mobile:vtmn-flex-row mobile:vtmn-flex-1 mobile:vtmn-w-full tablet:vtmn-w-1/3 vtmn-w-1/4">
			<img class="step-img" src="{{STATIC_URL}}img/new/step1.svg" alt="Step 1">
			<div class="mobile:vtmn-block vtmn-flex vtmn-flex-col vtmn-items-center mobile:vtmn-h-auto vtmn-h-full vtmn-place-content-center">
				<p class="vtmn-text-center mobile:vtmn-text-left">Je me connecte avec mon compte Decathlon</p>
				{% with decathlon=service_providers|svc_by_id:'decathlon' %}
					<a class="vtmn-btn vtmn-btn_size--small vtmn-mt-2" href="{{decathlon.UserAuthorizationURL}}">Se connecter</a>
				{% endwith %}
			</div>
		</li>
		<li class="mobile:vtmn-w-full tablet:vtmn-w-1/3 vtmn-w-1/4">
			<div class="vtmn-flex mobile:vtmn-space-x-2 vtmn-items-center vtmn-flex-col mobile:vtmn-flex-row mobile:vtmn-flex-1 vtmn-w-full">
				<img class="step-img" src="{{STATIC_URL}}img/new/step2.svg" alt="Step 2">
				<div class="mobile:vtmn-block vtmn-flex vtmn-flex-col vtmn-items-center mobile:vtmn-h-auto vtmn-h-full vtmn-place-content-center">
					<p class="vtmn-text-center mobile:vtmn-text-left">Je chosis le ou les service(s) que je veux synchroniser avec Decathlon</p>
				</div>
			</div>
			
			<div class="vtmn-hidden mobile:vtmn-block vtmn-mt-4">
				<div class="custom-little-title vtmn-my-2">Services compatibles</div>
				<div class="vtmn-grid vtmn-grid-cols-2 vtmn-gap-6">
					{% with localservices="decathlon decathlondev" %}
						{% for provider in service_providers %}
							{% if provider.ID not in config.withdrawn_services and provider.ID not in localservices.split %}
								<img src="{{STATIC_URL}}img/decathlon/logos/{{provider.ID}}.png" alt="{{provider.DisplayName}} logo">
							{% endif %}
						{% endfor %}
					{% endwith %}
				</div>
			</div>
		</li>
		<li class="mobile:vtmn-w-full tablet:vtmn-w-1/3 vtmn-w-1/4">
			<div class="vtmn-flex mobile:vtmn-space-x-2 vtmn-items-center vtmn-flex-col mobile:vtmn-flex-row mobile:vtmn-flex-1 vtmn-w-full">
				<img class="step-img" src="{{STATIC_URL}}img/new/step3.svg" alt="Step 3">
				<div class="mobile:vtmn-block vtmn-flex vtmn-flex-col vtmn-items-center mobile:vtmn-h-auto vtmn-h-full vtmn-place-content-center">
					<p class="vtmn-text-center mobile:vtmn-text-left">Je retrouve mes activités dans mes app préférées et je gagne des points deans mes apps Decathlon !</p>
					<a class="vtmn-btn vtmn-btn_size--small vtmn-btn_variant--conversion vtmn-mt-2" href="https://decatclub.decathlon.fr/">Decat'Club</a>
				</div>
			</div>
			

			<div class="vtmn-hidden mobile:vtmn-block vtmn-mt-4">
				<div class="custom-little-title vtmn-my-2">Applications Decathlon</div>
				<div class="vtmn-grid vtmn-grid-cols-3 vtmn-gap-3">
					<div>
						<img src="{{STATIC_URL}}img/decathlon/logos/dkt-connect.png" alt="Decathlon connect logo">
						<small class="vtmn-text-center grey-text vtmn-mt-2">Decathlon Connect</small>
					</div>
					<div>
						<img src="{{STATIC_URL}}img/decathlon/logos/dkt-coach.png" alt="Decathlon coach logo">
						<small class="vtmn-text-center grey-text vtmn-mt-2">Decathlon Coach</small>
					</div>
					<div>
						<img src="{{STATIC_URL}}img/decathlon/logos/e-connected.png" alt="Domyos e-connected logo">
						<small class="vtmn-text-center grey-text vtmn-mt-2">Domyos E-connected</small>
					</div>
				</div>
			</div>
		</li>
	</ul>

	<div class="vtmn-flex vtmn-flex-col mobile:vtmn-hidden vtmn-mt-5 vtmn-items-center">
		<div class="custom-little-title vtmn-my-2">Services compatibles</div>
		<div class="vtmn-grid vtmn-grid-cols-4 tablet:vtmn-grid-cols-3 tablet:vtmn-gap-6 small-desktop:vtmn-grid-cols-3 vtmn-gap-10 tablet:vtmn-w-full vtmn-w-2/3 vtmn-items-center vtmn-justify-items-center">
			
			{% with localservices="decathlon decathlondev" %}
				{% for provider in service_providers %}
					{% if provider.ID not in config.withdrawn_services and provider.ID not in localservices.split %}
						<img class="service-logo" src="{{STATIC_URL}}img/decathlon/logos/{{provider.ID}}.png" alt="{{provider.DisplayName}} logo">
					{% endif %}
				{% endfor %}
			{% endwith %}
		</div>
	</div>

	<div class="vtmn-flex vtmn-flex-col mobile:vtmn-hidden vtmn-mt-5 vtmn-items-center">
		<div class="custom-little-title vtmn-my-2">Applications Decathlon</div>
		<div class="vtmn-grid vtmn-grid-cols-3 vtmn-gap-1">
			<div class="vtmn-flex vtmn-flex-col vtmn-items-center">
				<img class="vtmn-w-3/4" src="{{STATIC_URL}}img/decathlon/logos/dkt-connect.png" alt="Decathlon connect logo">
				<small class="vtmn-text-center grey-text vtmn-mt-2">Decathlon Connect</small>
			</div>
			<div class="vtmn-flex vtmn-flex-col vtmn-items-center">
				<img class="vtmn-w-3/4" src="{{STATIC_URL}}img/decathlon/logos/dkt-coach.png" alt="Decathlon coach logo">
				<small class="vtmn-text-center grey-text vtmn-mt-2">Decathlon Coach</small>
			</div>
			<div class="vtmn-flex vtmn-flex-col vtmn-items-center">
				<img class="vtmn-w-3/4" src="{{STATIC_URL}}img/decathlon/logos/e-connected.png" alt="Domyos e-connected logo">
				<small class="vtmn-text-center grey-text vtmn-mt-2">Domyos E-connected</small>
			</div>
		</div>
	</div>

	<ul class="informations">
		<li>
			<h4>Sécurité</h4>
			<p>Vos email, mots de passe et activités sportives sont en lieu sûr, plus de détails sur la page
				données personnelles.</p>
		</li>
		<li>
			<h4>Comment ça marche ?</h4>
			<p>Il suffit de vous connecter avec Decathlon et ensuite vous connecter à tous les services que vous
				souhaitez synchroniser, puis cliquez sur "Lancer Synchro"</p>
			<a class="button secondary" href="./faq">Lire la FAQ</a>
		</li>
	</ul>
	{% else %}

		<div class="block">
			<p class="info">{% trans "Welcome !" %}</p>
			<p class="info">{% trans "Decathlon HUB synchronizes your recent activities between Garmin Connect, Polar Flow and Strava" %}</p>
		</div>

		<div class="block">
			<div class="serviceButtonOuter">
				<div class="serviceButtonWrap serviceButtonLogin row">
					{% for provider in service_providers %}
						{% if provider.ID in config.connection_services and provider.ID not in config.withdrawn_services %}
							{% include "service-button.html" with provider=provider inactive=True hideicon=True size=12 %}
						{% endif %}
					{% endfor %}
				</div>
			</div>
		</div>
	{% endifequal%}
{% endif %}
{% endblock %}





{% block specific-js %}
	{% if user != none %}
		<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
		<script src="{{STATIC_URL}}js/vue.js"></script>
		<script src="{{STATIC_URL}}js/dashboard_handler.js"></script>
	{% endif %}
{% endblock %}